---
title: "Code"
output: html_document
date: "2025-03-19"
---

## Settings

```{r, load-packages}
# Load required packages
install.packages("ggplot2", "stats", "tidyverse", "viridis", "emmeans")

library(ggplot2)
library(stats)
library(tidyverse)
library(viridis)
library(emmeans)

if (!require(ggsignif)) 
install.packages("ggsignif")
library(ggsignif)
```

```{r}
# Simulating data

# Example of one population
sampleSizeRequired = 200 # participants

# Conditions
condLabels = c("Excited", "Angry", "Calm", "Sad")
condPerParticipant = 1
# The pre-registeration said it is a within-subject design, but it has changed into between-subjects design.


# Outcome measures
# reactions time, likert responses

# Think through df
# rows = participants
# columns = condition(s), DVs, demographics

# rep = repetition

df <- data.frame(Participant=rep(0, sampleSizeRequired * condPerParticipant),
                 Condition=rep("NA", sampleSizeRequired, condPerParticipant),
                 ReactionTime=rep(0, sampleSizeRequired, condPerParticipant),
                 BetrayalChoices=rep(0, sampleSizeRequired, condPerParticipant),
                 Excited = rep(0, sampleSizeRequired, condPerParticipant),
                 Determined = rep(0, sampleSizeRequired, condPerParticipant),
                 Strong = rep(0, sampleSizeRequired, condPerParticipant),
                 Alert = rep(0, sampleSizeRequired, condPerParticipant),
                 Hostile = rep(0, sampleSizeRequired, condPerParticipant),
                 Distressed = rep(0, sampleSizeRequired, condPerParticipant),
                 Nervous = rep(0, sampleSizeRequired, condPerParticipant),
                 Guilty = rep(0, sampleSizeRequired, condPerParticipant),
                 PositiveEmotion = rep(0, sampleSizeRequired, condPerParticipant),
                 NegativeEmotion = rep(0, sampleSizeRequired, condPerParticipant),
                 stringsAsFactors=TRUE)

df$Participant <- rep(1:sampleSizeRequired, each = condPerParticipant)

# assign participants to a condition
df$Condition <- (rep(condLabels, size = sampleSizeRequired, replace = TRUE))

# create random RT in 4 conditions, this is seemed as the mean RT for all trials.

df$ReactionTime[df$Condition == "Excited"] = pmax(rnorm(sampleSizeRequired/condPerParticipant,
  mean = 1500, sd = 500), 300)
df$ReactionTime[df$Condition == "Angry"] = 
pmax(rnorm(sampleSizeRequired/condPerParticipant,
  mean = 1500, sd = 500), 300)
df$ReactionTime[df$Condition == "Calm"] = pmax(rnorm(sampleSizeRequired/condPerParticipant,
  mean = 3000, sd = 500), 300)
df$ReactionTime[df$Condition == "Sad"] = pmax(rnorm(sampleSizeRequired/condPerParticipant,
  mean = 3000, sd = 500), 300)

# Assign BetrayalChoices around 0 - 15 with higher number in Angry and Sad conditions, lower number in Excited and calm conditions

df$BetrayalChoices[df$Condition == "Excited"] <- round(rnorm(sum(df$Condition == "Excited"), mean = 4, sd = 3))
df$BetrayalChoices[df$Condition == "Angry"] <- round(rnorm(sum(df$Condition == "Angry"), mean = 12, sd = 3))
df$BetrayalChoices[df$Condition == "Calm"] <- round(rnorm(sum(df$Condition == "Calm"), mean = 4, sd = 3))
df$BetrayalChoices[df$Condition == "Sad"] <- round(rnorm(sum(df$Condition == "Sad"), mean = 12, sd = 3))

df$BetrayalChoices <- pmin(pmax(df$BetrayalChoices, 0), 15)

# create random responses on likert scale
df$Excited <- sample(c(1:5), sampleSizeRequired, replace = TRUE)
df$Determined <- sample(c(1:5), sampleSizeRequired, replace = TRUE)
df$Strong <- sample(c(1:5), sampleSizeRequired, replace = TRUE)
df$Alert <- sample(c(1:5), sampleSizeRequired, replace = TRUE)
df$Hostile <- sample(c(1:5), sampleSizeRequired, replace = TRUE)
df$Distressed <- sample(c(1:5), sampleSizeRequired, replace = TRUE)
df$Nervous <- sample(c(1:5), sampleSizeRequired, replace = TRUE)
df$Guilty <- sample(c(1:5), sampleSizeRequired, replace = TRUE)

# Calculate summed average for positive emotions (0 is lowest, 5 is highest)
df$PositiveEmotion <- rowSums(df[, c("Excited", "Determined", "Strong", "Alert")])/4

# Calculate summed average for negative emotions (0 is lowest, 5 is highest)
df$NegativeEmotion <- rowSums(df[, c("Hostile", "Distressed", "Nervous", "Guilty")])/ 4

View(df)
```

## Explore the data

# df = dataframe

```{r}

# conversion of data types if necessary
summary(df)

df_rt_summary_by_betrayalchoices_cond <- df %>%
group_by(Condition, BetrayalChoices) %>% #what vars you want to group by
summarise(
    mean_RT = mean(ReactionTime, na.rm = TRUE),
    median_RT = median(ReactionTime, na.rm = TRUE),
    sd_RT = sd(ReactionTime, na.rm = TRUE),
    min_RT = min(ReactionTime, na.rm = TRUE),
    max_RT = max(ReactionTime, na.rm = TRUE),
    n = n()
    )

sum(is.na(df_rt_summary_by_betrayalchoices_cond$sd_RT))  # This will show how many NAs are in the ReactionTime column

print(df_rt_summary_by_betrayalchoices_cond)

```

Exploration

```{r}
# get summary / descriptive stats

# check variable distributions (plot histograms)

# check correlations between variables

# scatterplots between 2 variables
```


## Planned inferential stats

```{r}
anova_result <- aov(ReactionTime ~ Condition * BetrayalChoices +
Error(Participant/Condition), data = df)
summary(anova_result)

# Conditions are significantly different to each other = yes main effect, hypothesis proved
# BetrayalChoices does not have a main effect on reaction time, no hypothesis is done on this, as it shouldn't have a main effect.
# No interaction effect between Conditions and BetrayalChoices, hypothesis failed

# The type of music does not affect people's choices, but do affect people's reaction (thinking time).

## post-hoc LSD
# 1. Get LSD results (same as before)
# Fit the ANOVA model
model <- aov(ReactionTime ~ Condition * BetrayalChoices, data = df)

# Calculate estimated marginal means (emmeans)
Condition_BetrayalChoices_means <- emmeans(model, ~ Condition * BetrayalChoices)

# Perform post-hoc pairwise comparisons (LSD)
lsd_results <- pairs(Condition_BetrayalChoices_means, adjust = "none")

# Convert the results into a summary data frame
lsd_summary <- as.data.frame(summary(lsd_results))

# View the summary results
print(lsd_summary)

# 2. Prepare mean ± SE data
plot_data <- summary(Condition_BetrayalChoices_means) |>
  transform(
    lower.CL = emmean - SE,
    upper.CL = emmean + SE
  )

# 3. Plot with significance bars
ggplot(plot_data, aes(x = Condition, y = emmean, fill = BetrayalChoices)) +
  geom_col(position = position_dodge(width = 0.8), width = 0.7) +
  geom_errorbar(
    aes(ymin = lower.CL, ymax = upper.CL),
    position = position_dodge(width = 0.8),
    width = 0.25
  ) +
  # Add significance bars manually for each stage
  geom_signif(
    y_position = max(plot_data$upper.CL) * 1.05,
    xmin = c(0.8, 1.8, 2.8),
    xmax = c(1.2, 2.2, 3.2),
    annotations = ifelse(lsd_summary$p.value < 0.05, 
                       ifelse(lsd_summary$p.value < 0.01, "**", "*"), 
                       "ns"),
    tip_length = 0.01
  ) +
  labs(
    title = "LSD Post-Hoc Comparisons",
    subtitle = "Error bars = ±1 SE | *p<0.05, **p<0.01, ns=not significant",
    x = "Condition",
    y = "Reaction Time",
    fill = "BetrayalChoices"
  ) +
  scale_fill_manual(values = c("Control" = "#F8766D", "Experiment" = "#00BFC4")) +
  theme_minimal()
```

## Planned visualization

```{r}

# box plot for reaction time matching each conditions
ggplot(df, aes(x = Condition, y = ReactionTime, fill = Condition)) +
  geom_boxplot(alpha = 0.6, outlier.shape = NA) +  
  geom_jitter(color = "black", size = 1, alpha = 0.5, width = 0.2) +  
  scale_fill_viridis(discrete = TRUE, alpha = 0.6 ) + 
  theme_minimal() +  
  labs(title = "Reaction Time Distributed by Condition",
       x = "Types of Background Music",
       y = "Reaction Time (ms)") +
  theme(legend.position = "none")

# condition matching betrayalcounts


# error = sem
# point estimates
# linear regressions
```
